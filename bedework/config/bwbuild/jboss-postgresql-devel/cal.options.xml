<?xml version="1.0"?>

<!-- This provides run time options for each of the configured applications.
  -->
<bedework-options>
  <org>
    <bedework>
      <global>
        <version>3.9</version>
        
        <!-- This property is how the running system finds the system settings.
             In theory we could have multiple settings with different names
             
             DO NOT CHANGE
         -->
        <systemName>bedework</systemName>

        <!-- This is used to prefix administrative group names to distinguish
             them from user group names. -->
        <adminGroupsIdPrefix>agrp_</adminGroupsIdPrefix>

        <!-- Uncomment this and set the value to one of the supported portals
             Values that will result in something happening are
             liferay5
             liferay4
             uportal2
        <portalPlatform>your-portal</portalPlatform>
         -->

        <!-- uris to cross link apps - of dubious usefulness -->
        <publicAdminUri>/caladmin</publicAdminUri>
        <publicCalendarUri>/cal</publicCalendarUri>
        <personalCalendarUri>/ucal</personalCalendarUri>

        <!-- CardDAV server locations -->
        <publicCardDAVHost>localhost</publicCardDAVHost>
        <publicCardDAVPort>8080</publicCardDAVPort>
        <publicCardDAVContext>/pubcarddav</publicCardDAVContext>
        
        <personalCardDAVHost>localhost</personalCardDAVHost>
        <personalCardDAVPort>8080</personalCardDAVPort>
        <personalCardDAVContext>/ucarddav</personalCardDAVContext>
           
        <!-- ===============================================================
                         Timezone server information
             =============================================================== -->

        <!-- Timezone server locations -->
        <timezonesUri>http://localhost:8080/tzsvr</timezonesUri>

        <!-- Initial value for the primary server url if not stored elsewhere.
             Used when initializing the tz server database -->
        <initialPrimaryUrl>@tzserverPrimaryUrl@</initialPrimaryUrl>

        <!-- Initial value for the primary/secondary server flag if not stored elsewhere.
             Used when initializing the tz server database -->
        <initialPrimaryServer>@tzserverPrimary@</initialPrimaryServer>

        <!-- Initial value for the refresh interval if not stored elsewhere.
             Used when initializing the tz server database -->
        <initialRefreshInterval>@tzdataRefreshInterval@</initialRefreshInterval>

        <!-- Public/private key locations -->
        <privKeys>@KEYFILE-DIR@/privkeys</privKeys>
        <pubKeys>@KEYFILE-DIR@/pubkeys</pubKeys>

        <!-- Now in system config class
        <systemRoots classname="org.bedework.calfacade.configs.SystemRoots" >
          <principalRoot>/principals</principalRoot>
          <userPrincipalRoot>/principals/users</userPrincipalRoot>
          <groupPrincipalRoot>/principals/groups</groupPrincipalRoot>
          <bwadmingroupPrincipalRoot>/principals/groups/bwadmin</bwadmingroupPrincipalRoot>
          <resourcePrincipalRoot>/principals/resources</resourcePrincipalRoot>
          <venuePrincipalRoot>/principals/locations</venuePrincipalRoot>
          <ticketPrincipalRoot>/principals/tickets</ticketPrincipalRoot>
          <hostPrincipalRoot>/principals/hosts</hostPrincipalRoot>
        </systemRoots>
         -->
        
        <synchWsdlUri>@synchWsdlURI@</synchWsdlUri>
        <synchManagerUri>@synchServiceManager@</synchManagerUri>
        
        <!-- This must match the connector id in the synch config. 
             It identifies which connection we are using for communication
             with the synch engine.
          -->
        <synchConnectorId>localBedework</synchConnectorId>

        <!-- To enable mapping of calendar addresses e.g. mailto:fred@example.org
             on to principals we need to either do a directory lookup or have
             some sort of pattern map. 
             
             Setting a caladdr prefix enables pattern mapping. By default 
             calendar addresses are users -->
             
          <!-- 
        <caladdrPrefixes classname="org.bedework.calfacade.configs.CalAddrPrefixes">
          <location>loc_</location>
        </caladdrPrefixes>     
           -->
        
        <!-- ===============================================================
                         Calendar system modules
             =============================================================== -->

        <module>
          <!-- A dummy module with no directory. -->
          <dir-config classname="org.bedework.calfacade.configs.DirConfigProperties">
            <!-- List domains at your site separated by commas.
                    A single leading wildcard "*" is allowed.
                    If there is a single domain with no wildcard it wil be stripped from
                    user accounts as they are entered and added as they are turned
                    back into CUAs.
                    Wildcarded or multiple domains will cause retention of the domain
                    (partially untested feature) -->
            <domains>mysite.edu</domains>

            <!-- defaultDomain can be left unspecified for no default or a single
                   exactly specified domain  -->
            <defaultDomain>mysite.edu</defaultDomain>

            <debug>true</debug>
          </dir-config>

          <!-- An example of how we might configure an ldap directory module. -->
          <user-ldap-group classname="org.bedework.calfacade.configs.LdapConfigProperties">
            <domains>mysite.edu</domains>
            <defaultDomain>mysite.edu</defaultDomain>

            <initialContextFactory>com.sun.jndi.ldap.LdapCtxFactory</initialContextFactory>
            <providerUrl>ldap://localhost:10389</providerUrl>
            <groupContextDn>ou=groups, dc=bedework, dc=org</groupContextDn>
            <groupMemberAttr>member</groupMemberAttr>
            <userDnPrefix>uid=</userDnPrefix>
            <userDnSuffix>,ou=accounts, dc=bedework, dc=org</userDnSuffix>
            <groupDnPrefix>cn=</groupDnPrefix>
            <groupDnSuffix>,ou=groups,dc=bedework, dc=org</groupDnSuffix>
            <debug>true</debug>

            <securityAuthentication>simple</securityAuthentication>
            <securityProtocol>NONE</securityProtocol>
            <authDn>uid=admin,ou=system</authDn>
            <authPw>secret</authPw>
          </user-ldap-group>

          <mailer classname="org.bedework.mail.MailConfigProperties">
            <protocol>smtp</protocol>
            <protocolClass>com.sun.mail.smtp.SMTPTransport</protocolClass>
            <serverIp>localhost</serverIp>
            <from>calendar.myplace.edu</from>
            <subject>Message from demo calendar server</subject>
            <disabled>false</disabled>
          </mailer>
        </module>
      </global>

      <!-- System parameters are used to INITIALISE the system settings during
           restore or a first time build of the data. 
           
           Values in the database take precedence after that and need to be 
           changed via the admin console on the system parameters page.
       -->
      <syspars classname="org.bedework.calfacade.BwSystem">
        <!-- name must match the global system name              
             DO NOT CHANGE
          -->
        <name>bedework</name>
        <tzid>America/New_York</tzid>
        <systemid>demobedework@mysite.edu</systemid>

        <!-- These become part of system roots -->
        <publicCalendarRoot>public</publicCalendarRoot>
        <userCalendarRoot>user</userCalendarRoot>
        <userDefaultCalendar>calendar</userDefaultCalendar>
        <defaultTrashCalendar>Trash</defaultTrashCalendar>
        <userInbox>Inbox</userInbox>
        <userOutbox>Outbox</userOutbox>
        <deletedCalendar>Deleted</deletedCalendar>
        <busyCalendar>Busy</busyCalendar>

        <defaultUserViewName>All</defaultUserViewName>
        <defaultUserHour24>true</defaultUserHour24>

        <publicUser>public-user</publicUser>

        <httpConnectionsPerUser>10</httpConnectionsPerUser>
        <httpConnectionsPerHost>50</httpConnectionsPerHost>
        <httpConnections>200</httpConnections>

        <!-- size limits -->
        <maxPublicDescriptionLength>500</maxPublicDescriptionLength>
        <maxUserDescriptionLength>5000</maxUserDescriptionLength>
        <maxUserEntitySize>100000</maxUserEntitySize>
        <defaultUserQuota>10000000</defaultUserQuota> <!-- 10 Meg OK? -->

        <!-- Max number of instances per recurring event -->
        <maxInstances>1000</maxInstances>

        <!-- Max number of years per recurring event -->
        <maxYears>50</maxYears>

        <userauthClass>org.bedework.calsvc.directory.UserAuthUWDbImpl</userauthClass>
        <mailerClass>org.bedework.mail.DummyMailer</mailerClass>
        <admingroupsClass>org.bedework.calsvc.directory.AdminGroupsDbImpl</admingroupsClass>
        <usergroupsClass>org.bedework.calsvc.directory.UserGroupsLdapImpl</usergroupsClass>
        <!--
        <usergroupsClass>org.bedework.calsvc.directory.GroupsDbImpl</usergroupsClass>
        -->

        <directoryBrowsingDisallowed>true</directoryBrowsingDisallowed>

        <indexRoot>lucene/indexroot</indexRoot>
        
        <useSolr>true</useSolr>
        <solrURL>http://localhost:8080/solr/</solrURL>
        
        <!-- Path to the core admin handlers. Configured into solr.xml -->
        <solrCoreAdmin>admin/cores/</solrCoreAdmin>
        
        <!-- The name of the default index we use in solr for public indexing.
             As we switch cores we use this as the base.  --> 
        <solrDefaultCore>bwpublic</solrDefaultCore>

        <rootUsers>admin</rootUsers>
      </syspars>

      <app>
        <!-- ===============================================================
                          Admin web client CalAdmin
             =============================================================== -->
        <CalAdmin classname="org.bedework.calfacade.configs.AdminConfig">
          <autoCreateContacts>false</autoCreateContacts>
          <autoDeleteContacts>false</autoDeleteContacts>
          <autoCreateLocations>false</autoCreateLocations>
          <autoDeleteLocations>false</autoDeleteLocations>

          <!-- if these are false only superuser can maintain public
               categories, locations and contacts -->
          <allowEditAllCategories>true</allowEditAllCategories>
          <allowEditAllLocations>true</allowEditAllLocations>
          <allowEditAllContacts>true</allowEditAllContacts>

          <categoryOptional>true</categoryOptional>

          <noGroupAllowed>false</noGroupAllowed>

          <appType>webadmin</appType>
          <publicAdmin>true</publicAdmin>
          <guestMode>false</guestMode>

          <!-- This will become a system configuration in time -->
          <submissionRoot>/public/unbrowsable/submissions</submissionRoot>

          <!-- Default value for 24 hour mode -->
          <hour24>true</hour24>

          <!-- Default value for minute increments -->
          <minIncrement>5</minIncrement>

          <logPrefix>PubEventsAdmin</logPrefix>
          
          <!-- Where the browser finds css and other resources -->    
          <browserResourceRoot>/caladminrsrc</browserResourceRoot>
          
          <!-- Where the server finds xsl etc -->    
          <appRoot>http://localhost:8080/caladminrsrc</appRoot>
        </CalAdmin>

        <!-- ==================================================================
                          Public event submission web client EventSubmit
             ================================================================== -->
        <EventSubmit classname="org.bedework.calfacade.configs.ClientConfig">
          <autoCreateContacts>false</autoCreateContacts>
          <autoDeleteContacts>false</autoDeleteContacts>
          <autoCreateLocations>false</autoCreateLocations>
          <autoDeleteLocations>false</autoDeleteLocations>

          <appType>websubmit</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>false</guestMode>

          <!-- This will become a system configuration in time -->
          <submissionRoot>/public/unbrowsable/submissions</submissionRoot>

          <!-- Default value for 24 hour mode -->
          <hour24>true</hour24>

          <!-- Default value for minute increments -->
          <minIncrement>5</minIncrement>

          <showYearData>false</showYearData>

          <logPrefix>EventSubmit</logPrefix>

          <!-- Where the browser finds css and other resources -->    
          <browserResourceRoot>/eventsubmitrsrc</browserResourceRoot>
          
          <!-- Where the server finds xsl etc -->    
          <appRoot>http://localhost:8080/eventsubmitrsrc</appRoot>

          <refreshAction>setup.do</refreshAction>
          <refreshInterval>900</refreshInterval>
        </EventSubmit>

        <!-- ==================================================================
                          Public web client Events
             ================================================================== -->
        <Events classname="org.bedework.calfacade.configs.ClientConfig">
          <cachingOn>true</cachingOn>
          <cachePrefix>bwpubevents</cachePrefix>

          <autoCreateContacts>false</autoCreateContacts>
          <autoDeleteContacts>false</autoDeleteContacts>
          <autoCreateLocations>false</autoCreateLocations>
          <autoDeleteLocations>false</autoDeleteLocations>

          <appType>webpublic</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>true</guestMode>

          <!-- Default value for 24 hour mode -->
          <hour24>true</hour24>

          <!-- Default value for minute increments -->
          <minIncrement>5</minIncrement>

          <showYearData>false</showYearData>

          <logPrefix>PubEvents</logPrefix>

          <!-- Where the browser finds css and other resources -->    
          <browserResourceRoot>/calrsrc</browserResourceRoot>
          
          <!-- Where the server finds xsl etc -->    
          <appRoot>http://localhost:8080/calrsrc</appRoot>

          <refreshAction>setup.do</refreshAction>
          <refreshInterval>300</refreshInterval>

          <calSuite>MainCampus</calSuite>
        </Events>

        <!-- ==================================================================
                          Feed Service
             ================================================================== -->
        <Feeder classname="org.bedework.calfacade.configs.ClientConfig">
          <cachingOn>true</cachingOn>
          <cachePrefix>bwfeeder</cachePrefix>

          <autoCreateContacts>false</autoCreateContacts>
          <autoDeleteContacts>false</autoDeleteContacts>
          <autoCreateLocations>false</autoCreateLocations>
          <autoDeleteLocations>false</autoDeleteLocations>

          <appType>feeder</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>true</guestMode>

          <!-- Default value for 24 hour mode -->
          <hour24>true</hour24>

          <!-- Default value for minute increments -->
          <minIncrement>5</minIncrement>

          <showYearData>false</showYearData>

          <logPrefix>Feeder</logPrefix>

          <!-- Where the browser finds css and other resources -->    
          <browserResourceRoot>/calfeedrsrc</browserResourceRoot>
          
          <!-- Where the server finds xsl etc -->    
          <appRoot>http://localhost:8080/calfeedrsrc</appRoot>

          <refreshAction>setup.do</refreshAction>
          <refreshInterval>300</refreshInterval>

          <calSuite>MainCampus</calSuite>
        </Feeder>

        <!-- ==================================================================
                          Demo departmental Public web client SoEDept
             ================================================================== -->
        <SoEDept classname="org.bedework.calfacade.configs.ClientConfig">
          <cachingOn>true</cachingOn>
          <cachePrefix>bwpubevents</cachePrefix>

          <autoCreateContacts>false</autoCreateContacts>
          <autoDeleteContacts>false</autoDeleteContacts>
          <autoCreateLocations>false</autoCreateLocations>
          <autoDeleteLocations>false</autoDeleteLocations>

          <appType>webpublic</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>true</guestMode>

          <!-- Default value for 24 hour mode -->
          <hour24>true</hour24>

          <!-- Default value for minute increments -->
          <minIncrement>5</minIncrement>

          <showYearData>false</showYearData>

          <logPrefix>SoEDept</logPrefix>

          <!-- Where the browser finds css and other resources -->    
          <browserResourceRoot>/calrsrc</browserResourceRoot>
          
          <!-- Where the server finds xsl etc -->    
          <appRoot>http://localhost:8080/calrsrc</appRoot>

          <refreshAction>setup.do</refreshAction>
          <refreshInterval>300</refreshInterval>

          <calSuite>SoEDepartmental</calSuite>
        </SoEDept>

        <!-- ==================================================================
                          User web client UserCal
             ================================================================== -->
        <UserCal classname="org.bedework.calfacade.configs.ClientConfig">
          <autoCreateContacts>false</autoCreateContacts>
          <autoDeleteContacts>false</autoDeleteContacts>
          <autoCreateLocations>false</autoCreateLocations>
          <autoDeleteLocations>false</autoDeleteLocations>

          <appType>webuser</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>false</guestMode>

          <!-- Default value for 24 hour mode -->
          <hour24>true</hour24>

          <!-- Default value for minute increments -->
          <minIncrement>5</minIncrement>

          <showYearData>false</showYearData>

          <logPrefix>PersonalCalendar</logPrefix>

          <!-- Where the browser finds css and other resources -->    
          <browserResourceRoot>/ucalrsrc</browserResourceRoot>
          
          <!-- Where the server finds xsl etc -->    
          <appRoot>http://localhost:8080/ucalrsrc</appRoot>

          <refreshAction>setup.do</refreshAction>
          <refreshInterval>300</refreshInterval>
        </UserCal>

        <!-- ===============================================================
                          User CalDAV server UserCalDAV
             =============================================================== -->
        <Usercaldav classname="org.bedework.caldav.util.CalDAVConfig">
          <appType>usercaldav</appType>
          <!--
          <publicAdmin>false</publicAdmin>
          -->
          <guestMode>false</guestMode>

          <sysintfImpl>org.bedework.caldav.bwserver.BwSysIntfImpl</sysintfImpl>

          <!-- Comment out or delete for no ischedule service
               Currently under development and may present a security risk in
               production systems -->
          <ischeduleURI>/ischedule</ischeduleURI>

          <!-- Comment out or delete for no freebusy url service -->
          <fburlServiceURI>/fbsvc</fburlServiceURI>

          <!-- Comment out or delete for no web calendar service -->
          <webcalServiceURI>/webcal</webcalServiceURI>

          <!-- SOAP web service 
               This corresponds to the full uri in the properties file.
               Defined as a global deployment property
               
               NOTE: tthe value below is defined in the build properties 
                -->
          <calSoapWsURI>@calSoapWsURI@</calSoapWsURI>
          
          <!-- This corresponds to the deployment path in the properties file.
               Defined as a global deployment property  -->
          <calSoapWsWSDLURI>http://localhost:8080/wsdls/calws-soap/wssvc.wsdl</calSoapWsWSDLURI>
        </Usercaldav>

        <!-- ==================================================================
                          Public (unauthenticated) CalDAV server PublicCalDAV
             ================================================================== -->
        <Pubcaldav classname="org.bedework.caldav.util.CalDAVConfig">
          <appType>publiccaldav</appType>
          <!--
          <publicAdmin>false</publicAdmin>
           -->
          <guestMode>true</guestMode>

          <sysintfImpl>org.bedework.caldav.bwserver.BwSysIntfImpl</sysintfImpl>

          <!-- Comment out or delete for no ischedule service
               Currently under development and may present a security risk in
               production systems

               Note that the uri "/ischedule" is defined in the draft and should
               not be changed to some other value. -->
          <ischeduleURI>/ischedule</ischeduleURI>

          <!-- Comment out or delete for no freebusy url service -->
          <fburlServiceURI>/fbsvc</fburlServiceURI>

          <!-- Comment out or delete for no web calendar service -->
          <webcalServiceURI>/webcal</webcalServiceURI>

          <!-- SOAP web service 
               This corresponds to the full uri in the properties file.
               Defined as a global deployment property
               
               NOTE: tthe value below is defined in the build properties 
                -->
          <calSoapWsURI>@calSoapWsURI@</calSoapWsURI>

          <!-- The bedework end of the synch service. This is a web
               service called by the synch engine to get information out of
               bedework and to update events and status.
               
               This path should probably be restricted to a given host only.
               
               Coming up on a separate port might help to lock it down.
               Comment out or delete for no synch service 
               -->
          <synchWsURI>/synchws/</synchWsURI>
        </Pubcaldav>

        <!-- ==================================================================
                          User CalWS server Usercalws
             ================================================================== -->
        <Usercalws classname="org.bedework.caldav.util.CalDAVConfig">
          <appType>usercalws</appType>
          <!--
          <publicAdmin>false</publicAdmin>
          -->
          <guestMode>false</guestMode>

          <sysintfImpl>org.bedework.caldav.bwserver.BwSysIntfImpl</sysintfImpl>
        </Usercalws>

        <!-- ==================================================================
                          Public (unauthenticated) CalWS server Pubcalws
             ================================================================== -->
        <Pubcalws classname="org.bedework.caldav.util.CalDAVConfig">
          <appType>publiccalws</appType>
          <!--
          <publicAdmin>false</publicAdmin>
           -->
          <guestMode>true</guestMode>

          <sysintfImpl>org.bedework.caldav.bwserver.BwSysIntfImpl</sysintfImpl>
        </Pubcalws>

        <!-- ==================================================================
                          CalDAV test suite
             ================================================================== -->
        <caldavTest classname="org.bedework.calfacade.configs.ConfigCommon">
          <appType>caldavTest</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>false</guestMode>
        </caldavTest>

        <!-- ==================================================================
                          bedework test suite
             ================================================================== -->
        <test classname="org.bedework.calfacade.configs.ConfigCommon">
          <appType>testsuite</appType>
          <publicAdmin>false</publicAdmin>
          <guestMode>false</guestMode>
        </test>

        <!-- ==================================================================
                          Dump restore program dumpres
             ================================================================== -->
        <dumpres classname="org.bedework.calfacade.configs.DumpRestoreConfig">
          <debug>true</debug>
          <appType>dumprestore</appType>
          <guestMode>true</guestMode>
          <debugEntity>false</debugEntity>
          <superGroupName>campusAdminGroups</superGroupName>
          <defaultPublicCalPath>/public/Other Events/Other</defaultPublicCalPath>
        </dumpres>

        <!-- ==================================================================
                          Crawler program
             ================================================================== -->
        <indexer classname="org.bedework.calfacade.configs.BwCrawlerConfig">
          <debug>true</debug>
          <appType>indexer</appType>
          <guestMode>true</guestMode>
          <debugEntity>false</debugEntity>
        </indexer>

        <!-- ==================================================================
                          System events logger program
             ================================================================== -->
        <sysevlog classname="org.bedework.calfacade.configs.BwCrawlerConfig">
          <debug>true</debug>
          <appType>sysevlog</appType>
          <guestMode>true</guestMode>
          <debugEntity>false</debugEntity>
        </sysevlog>

        <!-- ==================================================================
                          System events monitor program
             ================================================================== -->
        <monitor classname="org.bedework.calfacade.configs.BwCrawlerConfig">
          <debug>true</debug>
          <appType>monitor</appType>
          <guestMode>true</guestMode>
          <debugEntity>false</debugEntity>
        </monitor>

        <!-- ==================================================================
                          System key generator
             ================================================================== -->
        <genkeys classname="org.bedework.calfacade.configs.BwCrawlerConfig">
          <debug>true</debug>
          <appType>genkeys</appType>
          <guestMode>true</guestMode>
          <debugEntity>false</debugEntity>
        </genkeys>

        <!-- ==================================================================
                          In/outbox scheduler program
             ================================================================== -->
        <iosched classname="org.bedework.calfacade.configs.BwCrawlerConfig">
          <debug>true</debug>
          <appType>inoutsched</appType>
          <guestMode>true</guestMode>
          <debugEntity>false</debugEntity>
        </iosched>
      </app>
    </bedework>
  </org>
</bedework-options>

