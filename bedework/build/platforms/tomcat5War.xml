<?xml version="1.0"?>

<!-- ===================================================================
     This file is imported by buildwar.xml and adds the targets
     which will be invoked by the buildwar targets.
        addLibs: add libraries for this platform
        doPlatform - misc stuff
        deployWar: deploy the war to the server
        deployEar: deploy the ear to the server 
     =================================================================== -->

<project name="bedework.platformWar" default="doPlatform" >
  <target name="doPlatform" >
    <property name="propval.app.tomcat.context.xml"
              location="${app.sou.dir}/war/META-INF/context.xml" />
    <resolveFile name="app.tomcat.context.xml"
                 file="${propval.app.tomcat.context.xml}"
                 base="${app.sou.dir}"/>

    <copy tofile="${app.dest.metainf}/context.xml"
          file="${app.tomcat.context.xml}"
          overwrite="yes" >
      <filterset refid="property.filters" />
    </copy>
  </target>
  
  <!-- ================================================================
       Add libraries
       ================================================================ -->

  <target name="addLibs">
    <!-- Library in war file -->
    <property name="app.dest.lib"
              location="${app.dest.webinf}/lib" />
  </target>
  
  <!-- ================================================================
       Deploy war
       ================================================================ -->

  <target name="deployWar">
    <echo message="***************************************************************" />
    <echo message="Deploying standalone app ${app.war.file} into ${org.bedework.appserver.dir}/${propval.app.deploy.dir}" />
    <echo message="***************************************************************" />

    <!-- copy the war file. -->
    <copy todir="${org.bedework.appserver.dir}/${propval.app.deploy.dir}" file="${app.war.file}"
          overwrite="yes" />

    <!-- Delete expanded version -->
    <delete dir="${org.bedework.appserver.dir}/${propval.app.deploy.dir}/${propval.app.war.name}" />

    <!-- Delete the quickstart context def -->
    <delete file="${org.bedework.appserver.dir}/conf/Catalina/localhost/${propval.app.war.name}.xml" />
  </target>
    
  <!-- ================================================================
       Deploy ear
       ================================================================ -->

  <target name="deployEar">
  	<!-- Noop for tomcat -->
  </target>
</project>